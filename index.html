<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>सामानको रेकर्ड</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; margin: 0; }
        h2 { text-align: center; margin-bottom: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        .auth-section { text-align: center; padding: 40px; background: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .table-wrapper { overflow-x: auto; background: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 8px; display: none; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th { background: #9BBB59; color: #000; padding: 12px; border: 1px solid #ddd; font-weight: bold; text-align: center; position: sticky; top: 0; }
        td { padding: 10px; border: 1px solid #ddd; text-align: center; word-break: break-word; }
        tr:nth-child(even) { background: #f2f2f2; }
        tr:hover { background: #e8f5e0; }
        .loading { text-align: center; padding: 30px; font-style: italic; color: #666; }
        .error { color: red; }
    </style>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <h2>सामानको रेकर्ड</h2>
        <div id="authSection" class="auth-section">
            <p>यो पेज हेर्नको लागि Google खाताबाट लगइन गर्नुहोस्।</p>
            <div id="googleSignInButton"></div>
            <p id="authMessage" style="margin-top: 20px; color: red;"></p>
        </div>
        <div id="tableSection" class="table-wrapper">
            <table id="sheetTable">
                <thead>
                    <tr>
                        <th>कोड नं.</th>
                        <th>संकल नं.</th>
                        <th>सामानको नाम</th>
                        <th>स्पेसिफिकेशन</th>
                        <th>मोडल</th>
                        <th>पहिचान नं.</th>
                        <th>परिमाण</th>
                        <th>इकाई</th>
                        <th>कैफियत</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="9" class="loading">Loading data…</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const GOOGLE_CLIENT_ID = "101117674196-pkfn1k7ibmhues3a12gflnsufvi26jdc.apps.googleusercontent.com";
        const allowedEmails = ["niraz20@gmail.com"]; // Add more emails here

        const csvUrl = "https://corsproxy.io/?" + encodeURIComponent(
            "https://docs.google.com/spreadsheets/d/e/2PACX-1vT6ur5_QejKGwx6a3Sa4Yw8v1hyFyWp6XuwzX9IHdKkuTFFlXhFZ2dB2cdsXaZ_uG_DnSy4y1X8Fktv/pub?gid=486453257&single=true&output=csv"
        );

        let userEmail = null;

        google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleCredentialResponse,
            auto_select: false
        });

        google.accounts.id.renderButton(
            document.getElementById("googleSignInButton"),
            { theme: "outline", size: "large", text: "signin_with", locale: "en" }
        );

        function handleCredentialResponse(response) {
            const data = JSON.parse(atob(response.credential.split('.')[1]));
            userEmail = data.email;
            const authMessage = document.getElementById("authMessage");

            if (allowedEmails.includes(userEmail)) {
                document.getElementById("authSection").style.display = "none";
                document.getElementById("tableSection").style.display = "block";
                loadSheetData();
            } else {
                authMessage.textContent = "Access denied: Your email (" + userEmail + ") is not authorized.";
            }
        }

        function loadSheetData() {
            fetch(csvUrl)
                .then(response => { if (!response.ok) throw new Error("Network error"); return response.text(); })
                .then(csvText => {
                    Papa.parse(csvText, {
                        complete: function(results) {
                            const data = results.data;
                            const tbody = document.querySelector("#sheetTable tbody");
                            tbody.innerHTML = "";
                            for (let i = 1; i < data.length; i++) {
                                const row = data[i];
                                if (row.length === 1 || row.every(cell => cell.trim() === "")) continue;
                                const tr = document.createElement("tr");
                                for (let j = 0; j < 9; j++) {
                                    const td = document.createElement("td");
                                    td.textContent = row[j] ? row[j].trim() : "";
                                    tr.appendChild(td);
                                }
                                tbody.appendChild(tr);
                            }
                            if (tbody.children.length === 0) {
                                tbody.innerHTML = `<tr><td colspan="9" class="loading">No data found.</td></tr>`;
                            }
                        }
                    });
                })
                .catch(error => {
                    document.querySelector("#sheetTable tbody").innerHTML =
                        `<tr><td colspan="9" class="loading error">Failed to load data: ${error.message}</td></tr>`;
                });
        }
    </script>
</body>
</html>
